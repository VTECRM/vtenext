{"version":3,"sources":["webpack:///webpack/universalModuleDefinition","webpack:///webpack/bootstrap","webpack:///./src/utils.ts","webpack:///./src/index.ts","webpack:///./src/image-manager.ts"],"names":["root","factory","exports","module","define","amd","a","i","window","installedModules","__webpack_require__","moduleId","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","prototype","hasOwnProperty","p","s","Utils","createContentItem","options","dirName","src","item","document","createElement","insertAdjacentHTML","imgFolder","style","width","maxWidth","height","textAlign","margin","cursor","id","Date","now","toString","image_manager_1","ImageManager","utils_1","default","grapesjs","plugins","add","editor","config","__assign","url","credentials","beforeSend","beforeSetSrc","afterChoosingRunOpenAssets","headers","params","queryKey","modalTitle","btnText","textEmptyFolder","imgLoader","imgHome","imgReply","imgChevronRight","on","stylePrefix","getConfig","assetManager","AssetManager","imageExplorer","ImageExplorer","child","getContainer","querySelector","button","classList","onclick","open","textContent","insertAdjacentElement","this","requestHeader","breadcrumb","modalContent","loader","position","left","top","_this","modal","Modal","setTitle","fontSize","display","alignItems","padding","borderBottom","minHeight","flexWrap","Commands","isActive","stop","isOpen","close","content","append","fetch","then","response","setContent","catch","error","console","log","selectItem","isDir","target","getSelected","getImageSrc","set","setStyle","background-image","runCommand","directories","reduce","cur","directory","split","pop","dir","appendChild","Promise","resolve","files","file","fileName","isFile","e","path","hidden","firstChild","removeChild","_path","Error","breadcrumbInnerHTML","slice","join","length","innerHTML","param","URL","searchParams","method","res","setTimeout","status","json","text","reject","er"],"mappings":"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","file":"index.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([], factory);\n\telse {\n\t\tvar a = factory();\n\t\tfor(var i in a) (typeof exports === 'object' ? exports : root)[i] = a[i];\n\t}\n})(window, function() {\nreturn "," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 1);\n","export class Utils {\r\n\r\n  static createContentItem(options: any, dirName: string, src: any = null): HTMLElement {\r\n    const item = document.createElement('div');\r\n\r\n    if (!src) {\r\n      item.insertAdjacentHTML('beforeend', `<img src=\"${options.imgFolder}\" alt=\"${dirName || ''}\">`);\r\n    } else {\r\n      item.insertAdjacentHTML('beforeend', `<img src=\"${src}\" alt=\"${dirName || ''}\" style=\"max-width: 100%;max-height: calc(100% - 19px);\">`);\r\n    }\r\n\r\n    item.insertAdjacentHTML(\r\n      'beforeend',\r\n      `<p style=\"margin: 5px 0 10px;white-space: nowrap;text-overflow: ellipsis;overflow: hidden;font-size: 11px;\">${dirName || ''}</p>`\r\n    );\r\n\r\n    item.style.width = '10%';\r\n    item.style.maxWidth = '100px';\r\n    item.style.height = '70px';\r\n    item.style.textAlign = 'center';\r\n    item.style.margin = '5px';\r\n    item.style.cursor = 'pointer';\r\n    item.id = Date.now().toString();\r\n\r\n    return item;\r\n  }\r\n}\r\n","import {ImageManager} from \"./image-manager\";\r\nimport {Utils} from \"./utils\";\r\nexport {ImageManager};\r\nexport {Utils};\r\nexport default grapesjs.plugins.add('gjs-image-manager', (editor: any, options = {}) => {\r\n\r\n  const config = {\r\n    url: null,\r\n    credentials: 'include',\r\n    beforeSend: null,\r\n    beforeSetSrc: (src: string) => src,\r\n    afterChoosingRunOpenAssets: false,\r\n    headers: {},\r\n    params: {},\r\n    queryKey: 'path',\r\n    modalTitle: 'File Explorer',\r\n    btnText: 'Explorer images',\r\n    textEmptyFolder: 'Empty folder',\r\n    imgLoader: \"data:image/svg+xml,%3Csvg width='38' height='38' viewBox='0 0 38 38' xmlns='http://www.w3.org/2000/svg' stroke='%23fff'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg transform='translate(1 1)' stroke-width='2'%3E%3Ccircle stroke-opacity='.5' cx='18' cy='18' r='18'/%3E%3Cpath d='M36 18c0-9.94-8.06-18-18-18'%3E%3CanimateTransform attributeName='transform' type='rotate' from='0 18 18' to='360 18 18' dur='1s' repeatCount='indefinite'/%3E%3C/path%3E%3C/g%3E%3C/g%3E%3C/svg%3E\",\r\n    imgFolder: \"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='35' height='35' viewBox='0 0 24 24'%3E%3Cpath d='M0 0h24v24H0z' fill='none'/%3E%3Cpath fill='%23ffffff' d='M20 6h-8l-2-2H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V8c0-1.1-.9-2-2-2zm0 12H4V8h16v10z'/%3E%3C/svg%3E\",\r\n    imgHome: \"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='15' height='15' viewBox='0 0 24 24'%3E%3Cpath fill='%23ffffff' d='M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z'/%3E%3Cpath d='M0 0h24v24H0z' fill='none'/%3E%3C/svg%3E\",\r\n    imgReply: \"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='15' height='15' viewBox='0 0 24 24'%3E%3Cpath d='M0 0h24v24H0z' fill='none'/%3E%3Cpath fill='%23ffffff' d='M21 11H6.83l3.58-3.59L9 6l-6 6 6 6 1.41-1.41L6.83 13H21z'/%3E%3C/svg%3E\",\r\n    imgChevronRight: \"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='15' height='15' viewBox='0 0 24 24'%3E%3Cpath fill='%23ffffff' d='M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z'/%3E%3Cpath d='M0 0h24v24H0z' fill='none'/%3E%3C/svg%3E\",\r\n    ...options\r\n  };\r\n\r\n  editor.on('load', () => {});\r\n\r\n  const stylePrefix = editor.getConfig('stylePrefix');\r\n  const assetManager = editor.AssetManager;\r\n\r\n  const imageExplorer = new ImageManager(config);\r\n  editor.ImageExplorer = imageExplorer;\r\n\r\n  editor.on('run:open-assets', (child: any) => {\r\n\r\n    if (!assetManager.getContainer().querySelector(`.${stylePrefix}btn-explorer-images`)) {\r\n\r\n      const button = document.createElement('button');\r\n      button.classList.add(`${stylePrefix}btn-prim`);\r\n      button.classList.add(`${stylePrefix}btn-explorer-images`);\r\n      button.onclick = () => imageExplorer.open(editor);\r\n      button.textContent = config.btnText;\r\n      button.style.width = '100%';\r\n\r\n      assetManager.getContainer().insertAdjacentElement('beforeend', button);\r\n    }\r\n  });\r\n});\r\n","import {Utils} from \"./utils\";\r\n\r\nexport class ImageManager {\r\n  private readonly requestHeader = 'X-Requested-With';\r\n\r\n  private editor?: any;\r\n  private modal: any;\r\n  private loader: HTMLImageElement;\r\n  private breadcrumb: HTMLDivElement = document.createElement('div');\r\n  private modalContent: HTMLDivElement = document.createElement('div');\r\n\r\n  constructor(\r\n    private options: any = {},\r\n  ) {\r\n    this.loader = document.createElement('img');\r\n    this.loader.src = this.options.imgLoader;\r\n    this.loader.style.position = 'absolute';\r\n    this.loader.style.left = 'calc(50% - 38px)';\r\n    this.loader.style.top = 'calc(50% - 25px)';\r\n  }\r\n\r\n  public open(editor: any) {\r\n\r\n    if (!this.modal) {\r\n      this.modal = editor.Modal;\r\n      this.modal.setTitle(this.options.modalTitle);\r\n\r\n      this.breadcrumb.style.fontSize = '10px';\r\n      this.breadcrumb.style.display = 'flex';\r\n      this.breadcrumb.style.alignItems = 'center';\r\n      this.breadcrumb.style.cursor = 'pointer';\r\n      this.breadcrumb.style.padding = '0 10px 5px';\r\n      this.breadcrumb.style.borderBottom = '1px solid rgba(0,0,0,0.2)';\r\n\r\n      this.modalContent.classList.add('content');\r\n      this.modalContent.style.minHeight = '50px';\r\n      this.modalContent.style.display = 'flex';\r\n      this.modalContent.style.flexWrap = 'wrap';\r\n    }\r\n\r\n    // console.log('open', editor);\r\n    this.editor = editor;\r\n    if (editor.Commands.isActive('open-assets')) {\r\n      editor.Commands.stop('open-assets');\r\n    }\r\n\r\n    if (this.modal.isOpen()) {\r\n      this.modal.close();\r\n    }\r\n\r\n    const content = document.createElement('div');\r\n    content.style.position = 'relative';\r\n    content.style.padding = '0 0 10px';\r\n    content.append(this.breadcrumb);\r\n    content.append(this.modalContent);\r\n    content.append(this.loader);\r\n\r\n    this.modal.open({\r\n      content: content\r\n    });\r\n\r\n    this.fetch('').then((response) => {\r\n      this.setContent(response);\r\n    }).catch((error: any) => {\r\n      console.log(error);\r\n    });\r\n  }\r\n\r\n  private selectItem(item: string, isDir = true) {\r\n\r\n    if (isDir) {\r\n      this.fetch(item).then((response) => {\r\n        this.setContent(response);\r\n      }).catch((error: any) => {\r\n        console.log(error);\r\n      });\r\n    } else {\r\n\r\n      const target = this.editor.getSelected();\r\n\r\n      const src = this.getImageSrc(item);\r\n\r\n      if (!this.editor.AssetManager.get(src)) {\r\n        this.editor.AssetManager.add(src);\r\n      }\r\n\r\n      if (target) {\r\n        if (target.get('type') === 'image' || target.get('tagName') === 'img') {\r\n          target.set('src', src);\r\n        } else {\r\n          target.setStyle({'background-image': `url(${src})`});\r\n        }\r\n        this.modal.close();\r\n        if (this.options.afterChoosingRunOpenAssets) {\r\n          this.editor.runCommand('open-assets');\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  private setContent(response: any = {}) {\r\n    if (response) {\r\n\r\n      (response.directories || []).reduce((cur: any, directory: string) => cur.then((): any => {\r\n\r\n        const dirName: string = directory.split('/').pop() || '';\r\n        const dir = Utils.createContentItem(this.options, dirName);\r\n        dir.onclick = () => this.selectItem(directory);\r\n\r\n        return this.modalContent.appendChild(<any>dir);\r\n      }), Promise.resolve()).then((isDir: any) => {\r\n\r\n        (response.files || []).reduce((cur: any, file: string) => cur.then((): any => {\r\n\r\n          const fileName: string = file.split('/').pop() || '';\r\n          const item = Utils.createContentItem(this.options, fileName, this.getImageSrc(file));\r\n          item.onclick = () => this.selectItem(file, false);\r\n\r\n          return this.modalContent.appendChild(<any>item);\r\n        }), Promise.resolve()).then((isFile: any) => {\r\n\r\n          if (!isDir && !isFile) {\r\n            this.modalContent.insertAdjacentHTML('beforeend', `<p>${this.options.textEmptyFolder}</p>`);\r\n          }\r\n        });\r\n      });\r\n\r\n    } else {\r\n      this.modalContent.insertAdjacentHTML('beforeend', '<p>Wrong answer</p>');\r\n    }\r\n  }\r\n\r\n  private getImageSrc(file: string): string {\r\n    let src = file;\r\n\r\n    if (typeof this.options.beforeSetSrc === 'function') {\r\n      try {\r\n        src = this.options.beforeSetSrc(file);\r\n      }catch (e) {\r\n        console.log(e);\r\n      }\r\n    }\r\n    return src;\r\n  }\r\n\r\n  private fetch(path: string = '') {\r\n    this.loader.hidden = false;\r\n\r\n    try {\r\n      // if (this.modalContent.childNodes.length) {\r\n      //   this.modalContent.childNodes.forEach(child => child.remove());\r\n      // }\r\n      while (this.modalContent.firstChild) {\r\n        this.modalContent.removeChild(this.modalContent.firstChild);\r\n      }\r\n    } catch (e) {\r\n      console.log(e);\r\n    }\r\n\r\n    let _path: string = path || '';\r\n\r\n    if (typeof this.options.beforeSend === 'function') {\r\n      try {\r\n        path = this.options.beforeSend(path);\r\n      } catch (e) {\r\n        this.loader.hidden = true;\r\n        throw new Error('Error function beforeSend()');\r\n      }\r\n    }\r\n\r\n    const breadcrumbInnerHTML = path.split('/').slice(0, -1).join(` <img src=\"${this.options.imgChevronRight}\"> `);\r\n    if (breadcrumbInnerHTML.length) {\r\n      this.breadcrumb.innerHTML = `<img src=\"${this.options.imgReply}\"> ${breadcrumbInnerHTML}`;\r\n    } else {\r\n      this.breadcrumb.innerHTML = `<img src=\"${this.options.imgHome}\">`;\r\n    }\r\n    this.breadcrumb.onclick = () => this.selectItem(_path.split('/').slice(0, -1).join('/'));\r\n\r\n    if (!this.options.url || typeof this.options.url !== 'string') {\r\n      this.loader.hidden = true;\r\n      throw new Error('Unknown options url');\r\n    }\r\n    const url = new URL(this.options.url);\r\n    const headers = this.options.headers;\r\n\r\n    if (!headers[this.requestHeader]) {\r\n      headers[this.requestHeader] = 'XMLHttpRequest';\r\n    }\r\n\r\n    let param;\r\n    for (param in this.options.params) {\r\n      url.searchParams.append(param, this.options.params[param]);\r\n    }\r\n\r\n    url.searchParams.append(this.options.queryKey, path);\r\n\r\n    return fetch(url.toString(), {\r\n      method: 'GET',\r\n      credentials: this.options.credentials,\r\n      headers: headers\r\n    }).then((res) => {\r\n      setTimeout(() => {\r\n        this.loader.hidden = true;\r\n      }, 200);\r\n      if (((res.status / 200) | 0) === 1) {\r\n        let response;\r\n        try {\r\n          response = res.json();\r\n        } catch (e) {\r\n          response = res.text().then(text => Promise.reject(text));\r\n        }\r\n        return response;\r\n      } else {\r\n        return res.text().then(text => Promise.reject(text));\r\n      }\r\n    }).catch((e :any) => {\r\n      setTimeout(() => {\r\n        this.loader.hidden = true;\r\n      }, 200);\r\n      this.modalContent.insertAdjacentHTML('beforeend', `<p>Error connect to server - (<small>${e.toString()}</small>)</p>`);\r\n      return e.text().then((er:  any) => Promise.reject(er));\r\n    });\r\n  }\r\n}\r\n"],"sourceRoot":""}